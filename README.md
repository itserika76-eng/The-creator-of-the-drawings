# The creator of the drawings

Локальный прототип системы для подготовки чертежей под **КОМПАС-3D**.

## Что реализовано по требованиям

- ✅ Перенос с картинки: интегрирован CV-пайплайн (поиск линий/окружностей) и OCR рамки (если установлен `pytesseract`).
- ✅ Выбор версии КОМПАС: в GUI есть выбор `exe`/ярлыка перед запуском генерации.
- ✅ После генерации приложение автоматически открывает созданный `.cdw` в выбранном КОМПАС.
- ✅ Локальное приложение: интерфейс на `tkinter` + отдельный `start_app.bat` для быстрого запуска в Windows.
- ✅ Генерация по запросу: система использует веб-поиск (Wikipedia API) и локальный RAG по нормативной базе.
- ✅ Проверка ГОСТ/ЕСКД: базовые чек-листы + модуль проверки обозначений, допусков и спецификации.
- ✅ Экспорт в `.cdw`/`.spw`: подключен слой COM/KOMPAS API с fallback-экспортом в dev-среде без COM.
- ✅ Юридический пайплайн обновлений: реестр легальных источников + генерация snapshot разрешённых источников.

> ⚠️ В Linux/dev-контейнере COM API КОМПАС обычно недоступен, поэтому создаются только `.fallback.json`. Это сделано специально, чтобы не генерировать повреждённые `.cdw/.spw`, которые КОМПАС не может открыть.

## Быстрый старт

```bash
python3 -m venv .venv
source .venv/bin/activate
pip install -r requirements.txt
python app/main.py
```

## Быстрый запуск в Windows

Запускайте `start_app.bat` из корня проекта — батник сам создаст `.venv`, установит зависимости и откроет GUI.

## Артефакты генерации

В папке `output/` формируются:

- `drawing_package.json` — структурированный пакет проекта;
- `specification.csv` — спецификация;
- `kompas_macro_template.py` — шаблон импорта;
- `<project>.cdw` и `<project>.spw` — создаются только при доступном COM API КОМПАС.
- `<project>.cdw.fallback.json` и `<project>.spw.fallback.json` — диагностический fallback (не открываются как документы КОМПАС).

## Нормативная база и legal update

- Реестр источников: `app/data/standards_registry.json`.
- Локальные документы для RAG: `app/data/standards/*`.
- Пайплайн legal update: `app/legal_update.py` (создаёт `legal_sources_snapshot.json` только из разрешённых источников).

## Ограничения MVP

- Полноценные команды создания геометрии в COM API нужно адаптировать к конкретной версии КОМПАС-3D.
- OCR зависит от локальной установки Tesseract.
- RAG в MVP — retrieval по локальным текстам/выдержкам; для production нужен полнотекстовый индекс и контроль версий документов.
